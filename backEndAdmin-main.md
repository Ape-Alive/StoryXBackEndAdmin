# AI 能力中台后台管理系统

## 功能需求文档（PRD · 后台）

---

## 目录

- [1. 文档信息](#1-文档信息)
- [2. 系统整体功能说明](#2-系统整体功能说明)
  - [2.1 系统定位](#21-系统定位)
  - [2.2 用户角色](#22-用户角色)
- [3. 用户管理模块](#3-用户管理模块account-management)
  - [3.1 用户列表功能](#31-用户列表功能)
  - [3.2 用户状态管理](#32-用户状态管理)
  - [3.3 用户详情功能](#33-用户详情功能)
  - [3.4 用户设备管理](#34-用户设备管理)
- [4. 模型管理模块](#4-模型管理模块model-management)
  - [4.0 模型提供商管理](#40-模型提供商管理)
  - [4.1 模型列表功能](#41-模型列表功能)
  - [4.2 模型状态管理](#42-模型状态管理)
  - [4.3 模型价格管理](#43-模型价格管理)
- [5. 套餐 & 额度管理](#5-套餐--额度管理billing)
  - [5.1 套餐管理功能](#51-套餐管理功能)
  - [5.2 用户套餐管理](#52-用户套餐管理)
  - [5.3 额度管理功能（核心）](#53-额度管理功能核心)
  - [5.4 额度流水功能](#54-额度流水功能)
- [6. 提示词库管理](#6-提示词库管理prompt-library)
  - [6.1 提示词类型管理](#61-提示词类型管理)
  - [6.2 提示词版本管理](#62-提示词版本管理)
- [7. 风控与监控模块](#7-风控与监控模块risk--monitor)
  - [7.1 使用监控功能](#71-使用监控功能)
  - [7.2 风控规则管理](#72-风控规则管理)
- [8. 授权与调用管理](#8-授权与调用管理authorization)
  - [8.1 授权记录管理](#81-授权记录管理)
  - [8.2 Session Token 管理](#82-session-token-管理)
- [9. 日志与审计](#9-日志与审计)
  - [9.1 管理员操作日志](#91-管理员操作日志)
  - [9.2 AI 调用日志](#92-ai-调用日志)
- [10. 非功能需求](#10-非功能需求补充)

---

## 1. 文档信息

| 项目         | 内容                        |
| ------------ | --------------------------- |
| **文档类型** | 功能需求文档（PRD）         |
| **适用系统** | AI 能力中台 —— 后台管理系统 |
| **文档版本** | v1.0                        |
| **最后更新** | 2026                        |

### 使用对象

- 后端开发
- 管理后台前端
- 测试人员
- 产品 / 项目负责人

---

## 2. 系统整体功能说明

### 2.1 系统定位

后台系统用于对 **AI 能力中台** 进行：

- **用户管理**：用户账号、状态、权限管理
- **模型管理**：AI 模型资源、状态、价格配置
- **套餐与计费管理**：套餐配置、额度分配、计费策略
- **风控与监控**：使用监控、风控规则、告警管理
- **授权与调用审计**：调用授权、Session 管理、审计日志

> **说明**：本系统不直接面向 C 端用户，仅面向平台管理人员。

### 2.2 用户角色

| 角色           | 权限说明                       |
| -------------- | ------------------------------ |
| **超级管理员** | 全功能权限                     |
| **平台管理员** | 用户管理 / 模型管理 / 套餐管理 |
| **运营人员**   | 用户管理、套餐运营             |
| **风控人员**   | 风控规则配置、告警处理         |
| **财务人员**   | 结算管理、流水查询             |
| **只读角色**   | 查看权限，不可进行任何操作     |

---

## 3. 用户管理模块（Account Management）

### 3.1 用户列表功能

#### 功能说明

用于查看平台所有注册用户的基本信息与当前状态。

#### 使用角色

- 平台管理员
- 运营人员
- 风控人员（只读）

#### 功能点

**分页展示**

- 支持分页展示用户列表
- 默认每页 20 条，可调整

**条件筛选**

- 用户 ID
- 邮箱 / 手机号
- 用户状态（正常 / 冻结 / 封禁）
- 注册时间区间

**排序功能**

- 注册时间（升序 / 降序）
- 最近登录时间（升序 / 降序）
- 累计消耗额度（升序 / 降序）

#### 列表字段

| 字段         | 说明               |
| ------------ | ------------------ |
| 用户 ID      | 唯一标识           |
| 登录账号     | 邮箱或手机号       |
| 当前状态     | 正常 / 冻结 / 封禁 |
| 当前套餐     | 套餐名称           |
| 剩余额度     | 可用额度数值       |
| 最近登录时间 | 最后登录时间       |
| 注册时间     | 账号注册时间       |

#### 规则说明

- 被封禁用户需**高亮显示**（红色标识）
- 列表数据需实时反映用户状态
- 支持批量导出用户数据（Excel / CSV）

#### 验收标准

- ✅ 分页、筛选、排序结果准确
- ✅ 数据与数据库一致
- ✅ 筛选条件可组合使用
- ✅ 导出功能正常

---

### 3.2 用户状态管理

#### 功能说明

对用户账号进行冻结或封禁操作，控制用户访问权限。

#### 状态类型

| 状态     | 说明                   |
| -------- | ---------------------- |
| **正常** | 用户可正常使用所有功能 |
| **冻结** | 可恢复，临时限制使用   |
| **封禁** | 永久或定期封禁         |

#### 功能点

- 设置冻结原因（必填）
- 设置封禁时间段（永久 / 定期）
- 支持解冻 / 解封操作
- 查看状态变更历史

#### 规则说明

**冻结用户：**

- ❌ 禁止 AI 调用
- ✅ 允许登录
- ✅ 可查看历史数据

**封禁用户：**

- ❌ 禁止登录
- ❌ 禁止调用
- ❌ 现有 Session 立即失效
- ❌ 无法访问任何功能

#### 异常场景

| 场景               | 处理方式                 |
| ------------------ | ------------------------ |
| 已封禁用户重复封禁 | 提示"用户已处于封禁状态" |
| 解封已过期封禁     | 自动解封，无需手动操作   |
| 冻结正常用户       | 记录操作日志，发送通知   |

#### 验收标准

- ✅ 状态修改立即影响授权结果
- ✅ 所有操作记录操作日志
- ✅ 状态变更通知用户（可选）
- ✅ 封禁后 Session 立即失效

---

### 3.3 用户详情功能

#### 功能说明

查看单个用户的完整信息，包括基本信息、套餐、使用统计等。

#### 功能模块

**基本信息**

- 用户 ID、登录账号
- 注册时间、最后登录时间
- 账号状态
- 联系方式

**套餐信息**

- 当前套餐列表
- 套餐有效期
- 套餐优先级
- 可用额度

**使用统计**

- 近 7 / 30 天调用次数
- Token 消耗趋势（图表展示）
- 模型使用分布（饼图 / 柱状图）
- 成本统计

**设备信息**

- 已绑定设备列表
- 设备指纹、IP、地区
- 最后使用时间

#### 验收标准

- ✅ 数据来源清晰（标注数据来源表）
- ✅ 各模块数据一致
- ✅ 图表展示准确
- ✅ 支持数据导出

---

### 3.4 用户设备管理

#### 功能说明

管理用户已绑定设备，提升账号安全性，防止未授权访问。

#### 功能点

- 查看设备列表
- 显示设备信息：
  - 设备指纹
  - IP 地址
  - 地区信息
  - 最后使用时间
- 强制解绑设备
- 查看设备使用历史

#### 规则说明

- 解绑后设备需重新验证才能使用
- 解绑操作需记录日志
- 支持批量解绑

#### 验收标准

- ✅ 被解绑设备无法再次授权
- ✅ 解绑操作立即生效
- ✅ 设备列表实时更新

---

## 4. 模型管理模块（Model Management）

### 4.0 模型提供商管理

#### 功能说明

管理 AI 模型提供商信息，包括提供商基本信息、基路径配置等。提供商是模型的上层概念，一个提供商可以包含多个模型。

#### 使用角色

- **超级管理员**（仅限）

> **权限说明**：只有超级管理员可以创建、编辑、删除提供商信息，其他角色仅可查看。

#### 功能点

**基础功能**

- 查看提供商列表（分页展示）
- 查看提供商详细信息
- 创建新提供商
- 编辑提供商信息
- 删除提供商（需确认，删除前需检查是否有关联模型）
- 启用/禁用提供商（修改 `isActive`）

**搜索和筛选**

- 按提供商名称搜索（`name` / `displayName`）
- 按状态筛选（`isActive`: 启用 / 禁用）
- 按创建时间范围筛选（`createdAt`）

#### 列表字段

| 字段       | 说明                                                      | 对应数据库字段                            |
| ---------- | --------------------------------------------------------- | ----------------------------------------- |
| 提供商 ID  | 唯一标识符                                                | `id`                                      |
| 提供商标识 | 内部标识（唯一，如 "DeepSeek", "OpenAI", "Stability AI"） | `name`                                    |
| 显示名称   | 提供商显示名称                                            | `displayName`                             |
| 基路径     | API 服务基地址（如 `https://grsai.dakka.com.cn`）         | 需在 `AIProvider` 表中扩展 `baseUrl` 字段 |
| 官网链接   | 提供商官网地址                                            | `website`                                 |
| Logo 链接  | 提供商 Logo 图片地址                                      | `logoUrl`                                 |
| 描述       | 提供商描述信息                                            | `description`                             |
| 当前状态   | 是否启用（启用 / 禁用）                                   | `isActive`                                |
| 关联模型数 | 该提供商下的模型数量                                      | 计算字段                                  |
| 创建时间   | 提供商添加时间                                            | `createdAt`                               |
| 最后更新   | 信息更新时间                                              | `updatedAt`                               |

#### 创建/编辑字段

**必填字段**

- 提供商标识（`name`）：唯一标识，如 "DeepSeek", "OpenAI"
- 显示名称（`displayName`）：用于界面显示的名称
- 基路径：API 服务的基地址，如 `https://grsai.dakka.com.cn`

**可选字段**

- 描述（`description`）：提供商描述信息
- 官网链接（`website`）：提供商官网地址
- Logo 链接（`logoUrl`）：Logo 图片地址
- 是否启用（`isActive`）：默认为启用

#### 规则说明

**创建规则**

- 提供商标识（`name`）必须唯一，不可重复
- 基路径（`baseUrl`）必须为有效的 URL 格式，如 `https://grsai.dakka.com.cn`
- 创建后默认状态为启用（`isActive = true`）

> **注意**：基路径字段需要在 `AIProvider` 模型中扩展 `baseUrl String?` 字段。

**编辑规则**

- 提供商标识（`name`）创建后不可修改
- 其他字段可随时修改
- 修改基路径（`baseUrl`）会影响该提供商下所有模型的完整路径
- 基路径修改后，需同步更新该提供商下所有模型的全路径显示

**删除规则**

- 删除前需检查是否有关联的模型
- 如果有关联模型，需先删除或转移所有模型后才能删除提供商
- 删除操作需二次确认
- 删除操作不可恢复

**启用/禁用规则**

- 禁用提供商后，该提供商下的所有模型自动禁用
- 启用提供商不会自动启用其下的模型（需单独启用）

#### 异常场景

| 场景                   | 处理方式                                 |
| ---------------------- | ---------------------------------------- |
| 提供商标识重复         | 提示"提供商标识已存在，请使用其他标识"   |
| 删除有关联模型的提供商 | 提示"该提供商下存在模型，请先删除或转移" |
| 基路径格式错误         | 提示"请输入有效的 URL 格式"              |
| 非超级管理员尝试编辑   | 提示"权限不足，仅超级管理员可操作"       |

#### 验收标准

- ✅ 列表数据准确，与数据库 `AIProvider` 表一致
- ✅ 只有超级管理员可以创建、编辑、删除
- ✅ 提供商标识唯一性校验正确
- ✅ 删除前关联模型检查正确
- ✅ 基路径配置正确，影响模型完整路径
- ✅ 启用/禁用操作立即生效
- ✅ 所有操作记录操作日志

---

### 4.1 模型列表功能

#### 功能说明

管理平台支持的所有 AI 模型资源，包括模型信息查看、状态监控等。

#### 功能点

**基础功能**

- 查看模型列表（分页展示）
- 查看模型详细信息
- 查看关联的提供商信息

**搜索和筛选**

- 按模型名称搜索（`displayName` / `name`）
- 按接口路径搜索（`baseUrl`，如 `/v1/draw/nano-banana`）
- 按模型类型筛选（`type`: llm / video / image / tts）
- 按模型分类筛选（`category`）
- 按提供商筛选（`providerId`）
- 按状态筛选（`isActive`: 上线 / 下线）
- 按是否需要 API 密钥筛选（`requiresKey`）
- 按创建时间范围筛选（`createdAt`）

**批量操作**

- 批量启用/禁用模型（修改 `isActive`）
- 批量删除模型（需确认）
- 批量导出模型信息

#### 列表字段

| 字段     | 说明                                                                   | 对应数据库字段         |
| -------- | ---------------------------------------------------------------------- | ---------------------- |
| 模型 ID  | 唯一标识符                                                             | `id`                   |
| 模型名称 | 模型显示名称                                                           | `displayName`          |
| 模型标识 | 模型内部标识（如 "deepseek-chat", "gpt-4"）                            | `name`                 |
| 模型类型 | llm（文本生成）/ video（视频生成）/ image（图像生成）/ tts（语音合成） | `type`                 |
| 模型分类 | 分类标识（如 "chat", "completion", "generation"）                      | `category`             |
| 提供商   | 提供商显示名称                                                         | `provider.displayName` |
| 基路径   | API 服务基地址（如 `https://grsai.dakka.com.cn`）                      | `provider.baseUrl`     |
| 接口路径 | API 接口路径（如 `/v1/draw/nano-banana`）                              | `baseUrl`              |
| 全路径   | 完整的 API 地址（基路径 + 接口路径）                                   | 计算字段               |
| 当前状态 | 是否启用（上线 / 下线）                                                | `isActive`             |
| 创建时间 | 模型添加时间                                                           | `createdAt`            |
| 最后更新 | 配置更新时间                                                           | `updatedAt`            |

**说明**：

- 模型类型固定为：`llm`（大语言模型）、`video`（视频生成）、`image`（图像生成）、`tts`（语音合成）
- 当前状态基于 `isActive` 字段，`true` 为上线，`false` 为下线
- **路径说明**：
  - 基路径：来自关联提供商的 `baseUrl` 字段（如 `https://grsai.dakka.com.cn`）
  - 接口路径：存储在模型的 `baseUrl` 字段中，如 `/v1/draw/nano-banana`
  - 全路径：由提供商的基路径 + 模型的接口路径组合而成，用于实际 API 调用
- 灰度、限流等状态需通过其他配置表或状态字段实现（不在基础模型中）
- 默认价格信息需从价格配置表关联查询（不在 AIModel 表中）

#### 验收标准

- ✅ 列表数据准确，与数据库 `AIModel` 表一致
- ✅ 状态（`isActive`）实时更新
- ✅ 支持快速搜索和筛选
- ✅ 筛选条件可组合使用
- ✅ 关联的提供商信息正确显示
- ✅ 批量操作功能正常

---

### 4.2 模型状态管理

#### 功能说明

控制模型是否可被调用，支持基础状态和扩展状态管理。

#### 基础状态（基于 `isActive` 字段）

| 状态     | 说明         | 数据库字段         | 影响           |
| -------- | ------------ | ------------------ | -------------- |
| **上线** | 正常提供服务 | `isActive = true`  | 所有用户可调用 |
| **下线** | 停止服务     | `isActive = false` | 禁止新授权和禁止所以用户调用     |

#### 扩展状态（需通过配置表实现）

| 状态     | 说明     | 实现方式              |
| -------- | -------- | --------------------- | ---------------- |
| **灰度** | 灰度测试 | 通过灰度配置表/白名单 | 仅白名单用户可用 |
| **限流** | 限流保护 | 通过限流配置表        | 降低调用频率     |

#### 规则说明

**基础状态管理：**

- 通过修改 `isActive` 字段控制模型上线/下线
- 下线模型：
  - ❌ 禁止新授权
  - ✅ 已授权请求可继续（可选）
  - ✅ 显示下线原因（需记录在操作日志或备注中）

**扩展状态管理：**

- 灰度模型：

  - ✅ 仅对白名单用户 / 套餐开放
  - ✅ 支持设置灰度比例
  - ✅ 记录灰度使用数据
  - ⚠️ 需在 `isActive = true` 的基础上配置

- 限流模型：
  - ⚠️ 降低调用频率
  - ⚠️ 超出限制返回错误
  - ✅ 支持动态调整限流阈值
  - ⚠️ 需在 `isActive = true` 的基础上配置

#### 验收标准

- ✅ 状态变更实时生效
- ✅ 状态变更记录日志
- ✅ 灰度用户列表可配置

---

### 4.3 模型价格管理

#### 功能说明

配置模型调用价格策略，支持多种计费方式。

#### 功能点

- **Token 单价**：按输入/输出 Token 计费
- **次数单价**：按调用次数计费
- **套餐差异化价格**：不同套餐不同价格
- **价格历史记录**：保留价格变更历史
- **批量价格调整**：支持批量修改

#### 规则说明

- 价格配置需保留历史记录（审计需要）
- 已结算订单不受新价格影响
- 价格变更需审核（可选）
- 支持价格生效时间设置

#### 验收标准

- ✅ 不同套餐价格计算准确
- ✅ 价格历史可追溯
- ✅ 价格变更不影响已结算订单
- ✅ 支持价格预览和对比

---

## 5. 套餐 & 额度管理（Billing）

### 5.1 套餐管理功能

#### 功能说明

配置平台可售卖或分配的套餐，定义套餐的额度、有效期、可用模型等。

#### 功能点

- **创建 / 编辑套餐**
  - 套餐名称、描述
  - 套餐类型（免费 / 付费 / 试用）
- **设置有效期**
  - 永久有效 / 固定天数 / 自定义
- **设置总额度**
  - Token 额度 / 次数额度
  - 支持无限额度
- **设置可用模型列表**
  - 选择可用的模型
  - 支持模型权限控制
- **设置是否可叠加**
  - 是否允许用户拥有多个套餐
- **设置优先级**
  - 多套餐时的消耗顺序

#### 验收标准

- ✅ 套餐配置可正常被用户使用
- ✅ 套餐信息展示完整
- ✅ 支持套餐模板复制

---

### 5.2 用户套餐管理

#### 功能说明

为用户分配、调整套餐，管理用户的套餐关系。

#### 功能点

- **手动分配套餐**
  - 选择用户和套餐
  - 设置生效时间
- **设置套餐优先级**
  - 调整多套餐的消耗顺序
- **延期套餐有效期**
  - 延长套餐使用期限
- **取消套餐**
  - 移除用户套餐（需确认）

#### 规则说明

- 多套餐按优先级消耗额度
- 优先级高的套餐优先消耗
- 套餐到期自动失效
- 支持套餐续费提醒

#### 验收标准

- ✅ 扣减顺序正确
- ✅ 套餐分配立即生效
- ✅ 套餐变更记录日志

---

### 5.3 额度管理功能（核心）

#### 功能说明

管理用户 AI 调用额度，确保额度扣减的准确性和一致性。

#### 额度状态

| 状态       | 说明                   |
| ---------- | ---------------------- |
| **可用**   | 可正常使用的额度       |
| **冻结**   | 预冻结的额度（调用中） |
| **已消耗** | 已使用的额度           |

#### 扣减规则

1. **调用前预冻结**

   - 根据预估 Token 数预冻结额度
   - 防止并发超扣

2. **调用完成结算**

   - 根据实际消耗结算
   - 更新可用额度

3. **差额回退**
   - 实际消耗 < 预冻结 → 回退差额
   - 实际消耗 > 预冻结 → 补充扣减（需有余额）

#### 异常场景

| 场景     | 处理方式               |
| -------- | ---------------------- |
| 结算失败 | 自动回退冻结额度       |
| 额度不足 | 拒绝调用，返回错误     |
| 并发超扣 | 使用分布式锁防止       |
| 系统异常 | 记录异常日志，人工处理 |

#### 验收标准

- ✅ 并发下不超扣（压力测试通过）
- ✅ 每次变动有流水记录
- ✅ 额度计算准确（对账一致）
- ✅ 异常场景处理正确

---

### 5.4 额度流水功能

#### 功能说明

记录所有额度变化行为，提供完整的额度变动追溯。

#### 功能点

- **查看流水列表**
  - 分页展示
  - 支持时间范围筛选
- **支持条件筛选**
  - 用户 ID
  - 套餐 ID
  - 变动类型（增加 / 扣减 / 冻结 / 解冻）
  - 关联的 request_id
- **支持按 request_id 查询**
  - 查看单次调用的完整流水
- **流水详情**
  - 变动前额度
  - 变动金额
  - 变动后额度
  - 操作时间
  - 操作原因

#### 验收标准

- ✅ 流水与实际额度一致
- ✅ 流水记录完整（无遗漏）
- ✅ 支持流水导出
- ✅ 支持流水对账

---

## 6. 提示词库管理（Prompt Library）

### 6.1 提示词类型管理

#### 功能说明

管理平台提示词库，支持不同类型的提示词分类管理。

#### 提示词类型

| 类型           | 说明             | 权限                     |
| -------------- | ---------------- | ------------------------ |
| **系统提示词** | 平台系统级提示词 | 只读，仅管理员可修改     |
| **用户提示词** | 用户自定义提示词 | 用户可创建 / 编辑 / 删除 |
| **共享提示词** | 平台共享的提示词 | 管理员管理，用户可使用   |

#### 功能点

- **创建 / 编辑 / 删除**
  - 提示词标题、内容
  - 提示词描述
  - 提示词分类
- **标签管理**
  - 添加 / 删除标签
  - 标签分类
- **搜索功能**
  - 按标题、内容搜索
  - 按标签筛选
  - 按类型筛选

#### 验收标准

- ✅ 提示词分类清晰
- ✅ 搜索功能准确
- ✅ 权限控制正确

---

### 6.2 提示词版本管理

#### 功能说明

支持提示词修改历史管理，可查看历史版本并回滚。

#### 功能点

- **查看历史版本**
  - 版本号、修改时间
  - 修改人、修改内容
  - 版本对比（差异高亮）
- **回滚指定版本**
  - 选择历史版本回滚
  - 确认回滚操作
  - 回滚后创建新版本记录

#### 验收标准

- ✅ 回滚后立即生效
- ✅ 版本历史完整
- ✅ 版本对比清晰

---

## 7. 风控与监控模块（Risk & Monitor）

### 7.1 使用监控功能

#### 功能说明

监控平台 AI 使用情况，实时掌握系统运行状态。

#### 监控指标

| 指标             | 说明                 |
| ---------------- | -------------------- |
| **Token 使用量** | 输入/输出 Token 统计 |
| **QPS**          | 每秒查询数           |
| **并发数**       | 同时进行的请求数     |
| **成本消耗**     | 按模型统计成本       |

#### 监控维度

- **用户维度**：按用户统计使用情况
- **模型维度**：按模型统计调用情况
- **IP 维度**：按 IP 统计访问情况
- **设备维度**：按设备统计使用情况

#### 功能点

- 实时监控大屏
- 历史数据查询
- 数据图表展示（折线图 / 柱状图）
- 告警阈值设置
- 监控数据导出

#### 验收标准

- ✅ 监控数据实时更新
- ✅ 数据统计准确
- ✅ 图表展示清晰

---

### 7.2 风控规则管理

#### 功能说明

配置自动风控策略，自动识别和处理异常行为。

#### 功能点

- **创建 / 编辑规则**
  - 规则名称、描述
  - 触发条件设置
  - 动作配置
- **启停规则**
  - 启用 / 停用规则
  - 规则优先级设置
- **设置触发动作**
  - 选择动作类型
  - 配置动作参数

#### 动作类型

| 动作         | 说明                        |
| ------------ | --------------------------- |
| **限流**     | 降低调用频率                |
| **冻结额度** | 临时冻结用户额度            |
| **封禁账号** | 封禁用户账号                |
| **告警通知** | 发送告警通知（邮件 / 短信） |

#### 触发条件示例

- 短时间内大量调用（异常调用）
- 单次调用 Token 数异常
- 调用失败率过高
- 额度消耗过快

#### 验收标准

- ✅ 规则触发准确
- ✅ 动作执行及时
- ✅ 规则可灵活配置

---

## 8. 授权与调用管理（Authorization）

### 8.1 授权记录管理

#### 功能说明

记录所有 AI 调用授权行为，提供完整的授权追溯。

#### 记录字段

| 字段             | 说明              |
| ---------------- | ----------------- |
| **用户**         | 用户 ID、账号     |
| **设备**         | 设备指纹、IP      |
| **模型**         | 调用的模型名称    |
| **冻结额度**     | 预冻结的额度      |
| **Session 状态** | 授权 Session 状态 |
| **授权时间**     | 授权创建时间      |
| **过期时间**     | Session 过期时间  |
| **请求 ID**      | 关联的请求 ID     |

#### 功能点

- 查看授权记录列表
- 支持条件筛选（用户、设备、模型、时间）
- 查看授权详情
- 手动撤销授权
- 授权记录导出

#### 验收标准

- ✅ 授权记录完整
- ✅ 筛选功能准确
- ✅ 撤销授权立即生效

---

### 8.2 Session Token 管理

#### 功能说明

管理短期调用 Token，确保调用的安全性和时效性。

#### 规则

- **有效期极短**：Token 有效期通常为几分钟
- **一次性使用**：Token 使用后立即失效
- **不可刷新**：不支持 Token 刷新，需重新获取

#### 功能点

- 查看 Token 列表
- 查看 Token 状态（有效 / 已使用 / 已过期）
- 手动撤销 Token
- Token 使用统计

#### 验收标准

- ✅ Token 过期机制正确
- ✅ 一次性使用规则生效
- ✅ Token 撤销立即生效

---

## 9. 日志与审计

### 9.1 管理员操作日志

#### 功能说明

记录所有后台管理操作，提供完整的操作审计追溯。

#### 记录内容

- **操作人**：管理员账号、角色
- **操作时间**：精确到秒
- **操作类型**：创建 / 编辑 / 删除 / 状态变更等
- **操作对象**：用户 / 模型 / 套餐等
- **操作详情**：操作前后的数据对比
- **IP 地址**：操作来源 IP
- **操作结果**：成功 / 失败

#### 功能点

- 查看操作日志列表
- 支持条件筛选（操作人、操作类型、时间范围）
- 查看操作详情
- 日志导出
- 异常操作告警

#### 验收标准

- ✅ 所有操作都有日志记录
- ✅ 日志不可篡改
- ✅ 日志查询性能良好
- ✅ 支持日志归档

---

### 9.2 AI 调用日志

#### 功能说明

记录每次 AI 调用的摘要信息，用于问题排查和数据分析。

#### 记录内容

- **请求 ID**：唯一请求标识
- **用户信息**：用户 ID、账号
- **模型信息**：模型名称、版本
- **调用时间**：请求时间、响应时间
- **Token 统计**：输入 Token、输出 Token
- **调用结果**：成功 / 失败、错误信息
- **成本信息**：本次调用成本
- **设备信息**：IP、设备指纹

#### 功能点

- 查看调用日志列表
- 支持条件筛选（用户、模型、时间、状态）
- 查看调用详情
- 日志统计分析
- 日志导出

#### 验收标准

- ✅ 调用日志完整
- ✅ 日志查询快速
- ✅ 支持日志分析
- ✅ 敏感信息脱敏

---

## 10. 非功能需求（补充）

### 10.1 安全性

- ✅ 所有后台接口需鉴权（JWT Token）
- ✅ 支持角色权限控制（RBAC）
- ✅ 敏感操作需二次确认
- ✅ 密码加密存储
- ✅ 操作日志不可篡改
- ✅ 支持 IP 白名单（可选）

### 10.2 性能

- ✅ 授权接口响应时间 < 50ms（P99）
- ✅ 列表查询响应时间 < 500ms
- ✅ 支持数据缓存（Redis）
- ✅ 支持数据库读写分离（可选）
- ✅ 支持接口限流

### 10.3 可扩展性

- ✅ 支持新模型接入（插件化）
- ✅ 支持新计费方式扩展
- ✅ 支持多租户（可选）
- ✅ 模块化设计，易于扩展

### 10.4 可用性

- ✅ 系统可用性 > 99.9%
- ✅ 支持灰度发布
- ✅ 支持回滚机制
- ✅ 异常告警及时

### 10.5 数据一致性

- ✅ 额度扣减保证一致性（分布式事务）
- ✅ 数据对账机制
- ✅ 支持数据修复工具

---

## 附录

### A. 术语表

| 术语    | 说明                                          |
| ------- | --------------------------------------------- |
| Token   | AI 模型处理的最小单位，通常指文本 Token       |
| QPS     | 每秒查询数（Queries Per Second）              |
| Session | 用户会话，用于标识一次授权                    |
| 额度    | 用户可使用的 AI 调用量，可以是 Token 数或次数 |
| 套餐    | 用户购买的 AI 服务套餐，包含额度和有效期      |
| 灰度    | 仅对部分用户开放的功能或模型                  |

### B. 版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
| ---- | ---- | -------- | ------ |
| v1.0 | 2024 | 初始版本 | -      |

---

**文档结束**
