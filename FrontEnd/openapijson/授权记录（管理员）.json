{
  "openapi": "3.0.1",
  "info": {
    "title": "默认模块",
    "description": "",
    "version": "1.0.0"
  },
  "tags": [
    {
      "name": "授权管理"
    }
  ],
  "paths": {
    "/api/authorization": {
      "get": {
        "summary": "获取授权记录列表",
        "deprecated": false,
        "description": "获取授权记录列表，支持多种筛选条件和分页",
        "tags": [
          "授权管理"
        ],
        "parameters": [
          {
            "name": "userId",
            "in": "query",
            "description": "用户ID（可选）",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "modelId",
            "in": "query",
            "description": "模型ID（可选）",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "callToken",
            "in": "query",
            "description": "调用令牌（可选）",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "授权状态（可选）",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "revoked",
                "expired"
              ]
            }
          },
          {
            "name": "requestId",
            "in": "query",
            "description": "请求ID（可选）",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "activeOnly",
            "in": "query",
            "description": "是否只返回活跃的授权（可选，true/false）",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "开始日期（可选，ISO 8601格式）",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "结束日期（可选，ISO 8601格式）",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码（可选）",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "pageSize",
            "in": "query",
            "description": "每页数量（可选）",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/PaginatedResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Authorization"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            "headers": {}
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/authorization/{id}": {
      "get": {
        "summary": "获取授权记录详情",
        "deprecated": false,
        "description": "根据授权ID获取授权记录的详细信息",
        "tags": [
          "授权管理"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "授权记录ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/AuthorizationDetail"
                        }
                      }
                    }
                  ]
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "授权记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "delete": {
        "summary": "撤销授权",
        "deprecated": false,
        "description": "撤销指定的授权记录，如果授权是活跃状态且有冻结额度，会自动释放冻结的额度",
        "tags": [
          "授权管理"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "授权记录ID",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "撤销成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "success": {
                              "type": "boolean",
                              "example": true
                            },
                            "refundedQuota": {
                              "type": "number",
                              "description": "释放的额度",
                              "example": 10.5
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "授权记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/authorization/session/{sessionToken}": {
      "get": {
        "summary": "根据 sessionToken 获取授权记录",
        "deprecated": false,
        "description": "",
        "tags": [
          "授权管理"
        ],
        "parameters": [
          {
            "name": "sessionToken",
            "in": "path",
            "description": "",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "*/*": {
                "schema": {
                  "type": "object",
                  "properties": {}
                }
              }
            }
          }
        },
        "security": []
      }
    },
    "/api/authorization/call-token/{callToken}": {
      "get": {
        "summary": "根据 callToken 获取授权记录",
        "deprecated": false,
        "description": "根据调用令牌（callToken）获取授权记录的详细信息",
        "tags": [
          "授权管理"
        ],
        "parameters": [
          {
            "name": "callToken",
            "in": "path",
            "description": "调用令牌",
            "required": true,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "获取成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/AuthorizationDetail"
                        }
                      }
                    }
                  ]
                }
              }
            },
            "headers": {}
          },
          "401": {
            "description": "未授权",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          },
          "404": {
            "description": "授权记录不存在",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "example": "Error message"
          },
          "errors": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {}
            }
          }
        }
      },
      "Success": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string",
            "example": "Success message"
          },
          "data": {
            "type": "object",
            "properties": {}
          }
        }
      },
      "PaginatedResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string",
            "example": "Success"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {}
            }
          },
          "page": {
            "type": "integer",
            "example": 1
          },
          "pageSize": {
            "type": "integer",
            "example": 20
          },
          "total": {
            "type": "integer",
            "example": 100
          }
        }
      },
      "Authorization": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "授权记录ID",
            "example": "clx123456789"
          },
          "userId": {
            "type": "string",
            "description": "用户ID",
            "example": "clx987654321"
          },
          "modelId": {
            "type": "string",
            "description": "模型ID",
            "example": "clx111222333"
          },
          "deviceFingerprint": {
            "type": "string",
            "description": "设备指纹",
            "example": "device-fingerprint-123"
          },
          "ipAddress": {
            "type": "string",
            "description": "IP地址",
            "nullable": true,
            "example": "192.168.1.1"
          },
          "frozenQuota": {
            "type": "number",
            "format": "decimal",
            "description": "预冻结额度",
            "example": 10.5
          },
          "callToken": {
            "type": "string",
            "description": "调用令牌",
            "nullable": true,
            "example": "abc123def456..."
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "revoked",
              "expired",
              "used"
            ],
            "description": "授权状态",
            "example": "active"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time",
            "description": "过期时间",
            "example": "2026-02-11T10:00:00Z"
          },
          "requestId": {
            "type": "string",
            "description": "请求ID",
            "nullable": true,
            "example": "req-123456"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间",
            "example": "2026-02-11T09:00:00Z"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间",
            "example": "2026-02-11T09:00:00Z"
          },
          "user": {
            "type": "object",
            "description": "用户信息",
            "properties": {
              "id": {
                "type": "string"
              },
              "email": {
                "type": "string",
                "nullable": true
              },
              "phone": {
                "type": "string",
                "nullable": true
              }
            }
          },
          "model": {
            "type": "object",
            "description": "模型信息",
            "properties": {
              "id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "displayName": {
                "type": "string"
              },
              "provider": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "displayName": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "AuthorizationDetail": {
        "allOf": [
          {
            "$ref": "#/components/schemas/Authorization"
          },
          {
            "type": "object",
            "properties": {
              "user": {
                "type": "object",
                "description": "用户完整信息",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "nullable": true
                  },
                  "phone": {
                    "type": "string",
                    "nullable": true
                  },
                  "role": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string"
                  }
                }
              },
              "model": {
                "type": "object",
                "description": "模型完整信息",
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "displayName": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string"
                  },
                  "category": {
                    "type": "string",
                    "nullable": true
                  },
                  "baseUrl": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string",
                    "nullable": true
                  },
                  "isActive": {
                    "type": "boolean"
                  },
                  "apiConfig": {
                    "type": "string",
                    "nullable": true
                  },
                  "provider": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string"
                      },
                      "name": {
                        "type": "string"
                      },
                      "displayName": {
                        "type": "string"
                      },
                      "baseUrl": {
                        "type": "string"
                      },
                      "isActive": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    },
    "responses": {},
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "输入 JWT Token，格式：Bearer {token}"
      }
    }
  },
  "servers": [],
  "security": []
}